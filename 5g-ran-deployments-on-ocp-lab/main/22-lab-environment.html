<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab Environment :: LAB - 5G RAN Deployments on OpenShift</title>
    <link rel="canonical" href="https://pages.sysdeseng.com/5g-ran-deployments-on-ocp-lab/5g-ran-deployments-on-ocp-lab/main/22-lab-environment.html">
    <link rel="prev" href="11-deployment-considerations.html">
    <link rel="next" href="23-lab-environment-introduction.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://pages.sysdeseng.com/5g-ran-deployments-on-ocp-lab">LAB - 5G RAN Deployments on OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="5g-ran-deployments-on-ocp-lab" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="00-introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="00-introduction.html#lab-aim">Who is this lab aimed at? </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="00-introduction.html#lab-software-versions">Lab Software Versions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-5g-ran-context.html">5G Ran Context</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#low-latency">Low Latency</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#numa-nodes">NUMA Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#huge-pages">Huge Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#cpu-pinning">CPU Pinning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#irq-load-balancing">IRQ Load Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#dpdk">DPDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#oot-drivers">OoT Drivers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#cpu-reduction-tuning">Tuning for CPU Reduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#vran-accelerators">vRAN Dedicated Accelerators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-5g-ran-context.html#ptp">PTP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-sno-intro.html">Introduction to Single Node OpenShift (SNO)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-sno-intro.html#5g-ran">5G Radio Access Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-sno-intro.html#things-keep-mind">Things to keep in mind</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-sno-intro.html#deployments">Deployments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-sno-intro.html#extra-information">Extra information</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-cnf-operators-intro.html">Introduction to CNF Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-cnf-operators-intro.html#node-tuning-operator">Node Tuning Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-cnf-operators-intro.html#sriov-operator">SR-IOV Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-cnf-operators-intro.html#ptp-operator">PTP Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-cnf-operators-intro.html#accelerators-operators">Accelerators Operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="04-ztp-intro.html">Introduction to Zero Touch Provisioning (ZTP)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-ocp-gitops.html">OpenShift GitOps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-ocp-gitops.html#gitops">GitOps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-ocp-gitops.html#gitops-principles">GitOps Principles</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-ocp-gitops.html#gitops-patterns-ocp">GitOps Patterns on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-ocp-gitops.html#directories-vs-branches">Directories vs Branches</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-ocp-gitops.html#direct-commit-to-main">Direct commit to main</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-ocp-gitops.html#prs-review-cycles">Pull Requests and review cycles</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-ocp-gitops.html#gitops-ocp">GitOps on OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-ztp-at-scale.html">ZTP Components</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-ztp-at-scale.html#rhacm">Red Hat Advanced Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="08-ztp-at-scale.html#mce">Multicluster Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="08-ztp-at-scale.html#ai">Infrastructure Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-ztp-at-scale.html#gitops-operator">GitOps Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="08-ztp-at-scale.html#sitegen">SiteGen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="08-ztp-at-scale.html#policygen">PolicyGen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="08-ztp-at-scale.html#talm">Topology Aware Lifecycle Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="21-ztp-workflow.html">ZTP Workflow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-rhacm-policies.html">RHACM Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-rhacm-policies.html#policy-framework">Policy Framework</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-rhacm-policies.html#policies">Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-rhacm-policies.html#policy-status">Policy Status</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-rhacm-policies.html#policy-remediation">Policy Remediation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07-managing-at-scale.html">Managing at Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-managing-at-scale.html#inform-policies">Inform Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-managing-at-scale.html#olm-subscriptions">OLM Subscriptions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-managing-at-scale.html#cluster-policies">Cluster Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="09-talm.html">Topology Aware Lifecycle Manager (TALM)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-talm.html#inform-policies">Default Inform Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="09-talm.html#cgu">Cluster Group Upgrade</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="09-talm.html#autocreation-cgu">Auto Creation of CGUs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-talm.html#phase-labels">Phase labels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-talm.html#waves">Policy Waves</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-talm.html#talm-precache">Precaching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-talm.html#talm-backup">Backup &amp; Recovery</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-policygen-deepdive.html">PolicyGen Deepdive</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-policygen-deepdive.html#policygen-implementation">PolicyGen Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-policygen-deepdive.html#kustomize-plugins">Kustomize Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#siteconfig-generator">SiteConfigGenerator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#policy-generator">Policy Generator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-policygen-deepdive.html#5g-ran-profile">5G RAN Profile</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#workload-partitioning">Workload Partitioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#kubelet-tuning">Kubelet Tuning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#sctp">SCTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#hide-container-mount">Container Mount Hiding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#recovery-optimization">Recovery Optimization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#monitoring-footprint">Monitoring Operator Config</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#ocp-console">Console Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#networking-diags">Networking Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#operatorhub">OperatorHub</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#ptp-operator">PTP Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#sr-iov">SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#nto">Node Tuning Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#local-storage">Local Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10-policygen-deepdive.html#logs">Log Collector and Forwarder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-policygen-deepdive.html#siteconfig-templating">SiteConfig Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-policygen-deepdive.html#policies-templating">Policies Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-policygen-deepdive.html#kustomize-plugins-locally">Running Kustomize Plugins Locally</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-deployment-considerations.html">Deployment Considerations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-deployment-considerations.html#hardware-configurations">Hardware configurations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11-deployment-considerations.html#bios-settings">Bios Settings</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-deployment-considerations.html#networking">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-deployment-considerations.html#disconnected-environments">Disconnected Environments</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11-deployment-considerations.html#connected-proxy">Connected through proxy</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11-deployment-considerations.html#fully-disconnected">Fully disconnected</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-deployment-considerations.html#git-repo-structure">Git Repository Structure</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="22-lab-environment.html">Lab Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lab-requirements">Lab Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#lab-deployment">Lab Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#install-kcli">Install KCli</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#install-oc-kubectl">Install oc/kubectl CLIs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-disconnected-network">Configure Disconnected Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-local-dns-dhcp-server">Configure Local DNS/DHCP Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-local-dns-as-primary-server">Configure Local DNS as Primary Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#disable-firewall">Disable Firewall</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#install-sushytools">Install Sushy Tools</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-disconnected-registry">Configure Disconnected Registry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-git-server">Configure Git Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#create-openshift-nodes-vms">Create OpenShift Nodes VMs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploy-openshift-hub-cluster">Deploy OpenShift Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-openshift-hub-cluster">Configure OpenShift Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploy-openshift-hub-cluster-operators">Deploy OpenShift HUB Cluster Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploy-sno1-cluster-without-ztp">Deploy SNO1 Cluster (without ZTP)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#configure-access-to-cluster-apps">Configure Access to Cluster Apps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="23-lab-environment-introduction.html">Introduction to the Lab Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-lab-environment-introduction.html#git-server">Git Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-lab-environment-introduction.html#container-registry">Container Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-lab-environment-introduction.html#openshift-hub-cluster">OpenShift Hub Cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="12-crafting-deployments-iaac.html">Crafting Deployment&#8217;s IaaC</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-crafting-deployments-iaac.html#introduction-to-siteconfig">Introduction to the SiteConfig</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="12-crafting-deployments-iaac.html#crafting-our-own-siteconfig">Crafting our own SiteConfig</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="12-crafting-deployments-iaac.html#git-repository">Git Repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="12-crafting-deployments-iaac.html#baremetal-node-details">Bare Metal Node Details</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="12-crafting-deployments-iaac.html#pre-reqs">Deployment Prerequesites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="12-crafting-deployments-iaac.html#siteconfig">SiteConfig</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html">Crafting Cluster and CNF Operators Configs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html#crafting-common-policies">Crafting Common Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html#crafting-group-policies">Crafting Group Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html#crafting-zone-policies">Crafting Zone Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html#crafting-site-policies">Crafting Site Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-crafting-cluster-cnf-operators-configs.html#configure-kustomization-for-policies">Configure Kustomization for Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="14-running-the-deployment.html">Running the Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-running-the-deployment.html#deploying-ztp-gitops-pipeline">Deploying the ZTP GitOps Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14-running-the-deployment.html#deploying-sno-using-gitops-pipeline">Deploying the SNO Cluster using the ZTP GitOps Pipeline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="15-monitoring-the-deployment.html">Monitoring the Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15-monitoring-the-deployment.html#monitoring-deployment-webui">Monitoring the Deployment via the WebUI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15-monitoring-the-deployment.html#monitoring-deployment-cli">Monitoring the Deployment via the CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="24-managing-existing-clusters.html">Managing Existing Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="16-check-deployment-is-finished.html">Check Deployment is finished</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="17-using-talm-to-update-clusters.html">Using TALM to update clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="18-troubleshooting-tips.html">Troubleshooting Tips</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="19-common-pitfalls.html">Common Pitfalls</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-common-pitfalls.html#exec-probes-cpu-pinning">Exec Probes and CPU Pinning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-common-pitfalls.html#energy-saving-hw-profiles">Energy Saving Hardware Profiles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-common-pitfalls.html#secure-boot-oot-unsigned-drivers">Secure Boot and Unsigned OoT Drivers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-common-pitfalls.html#sriov-node-drain">SR-IOV Node Drain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19-common-pitfalls.html#pod-disruption-budgets">Pod Disruption Budgets</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="20-closing-thoughts.html">Closing Thoughts</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">LAB - 5G RAN Deployments on OpenShift</a></li>
    <li><a href="22-lab-environment.html">Lab Environment</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/RHsyseng/5g-ran-deployments-on-ocp-lab/edit/main/documentation/modules/ROOT/pages/22-lab-environment.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab Environment</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Next lab sections rely on having a lab environment accesible in order to do the hands-on work. If you&#8217;re a Red Hatter you can order a lab environment on <a href="https://insertlinktorhpdshere">RHPDS</a>. Otherwise keep reading to deploy your own lab environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lab-requirements"><a class="anchor" href="#lab-requirements"></a>Lab Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RHEL 8+ (or similar) box with access to the Internet. This lab relies on KVM, so a baremetal host is highly recommended. Our lab environment has the following specs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>48 CPUs</p>
</li>
<li>
<p>200GiB Memory</p>
</li>
<li>
<p>1 TiB storage</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lab-deployment"><a class="anchor" href="#lab-deployment"></a>Lab Deployment</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All the steps in the below sections must be run as <code>root</code> user on the hypervisor host.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="install-kcli"><a class="anchor" href="#install-kcli"></a>Install KCli</h3>
<div class="paragraph">
<p>We use <a href="https://github.com/karmab/kcli">KCli</a> to do several things, like managing VMs, deploying the first OCP cluster, etc.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# dnf -y copr enable karmab/kcli
[root@hypervisor ~]# dnf -y install kcli bash-completion vim jq tar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-oc-kubectl"><a class="anchor" href="#install-oc-kubectl"></a>Install oc/kubectl CLIs</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# kcli download oc -P version=stable -P tag='4.11'
[root@hypervisor ~]# kcli download kubectl -P version=stable -P tag='4.11'
[root@hypervisor ~]# mv kubectl oc /usr/bin/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-disconnected-network"><a class="anchor" href="#configure-disconnected-network"></a>Configure Disconnected Network</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# kcli create network -c 192.168.125.0/24 --nodhcp --domain 5g-deployment.lab 5gdeploymentlab</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-local-dns-dhcp-server"><a class="anchor" href="#configure-local-dns-dhcp-server"></a>Configure Local DNS/DHCP Server</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# dnf -y install dnsmasq policycoreutils-python-utils
[root@hypervisor ~]# mkdir -p /opt/dnsmasq/include.d/
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/dnsmasq.conf" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/dnsmasq.conf</a> -o /opt/dnsmasq/dnsmasq.conf
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/upstream-resolv.conf" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/upstream-resolv.conf</a> -o /opt/dnsmasq/upstream-resolv.conf
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/hub.ipv4" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/hub.ipv4</a> -o /opt/dnsmasq/include.d/hub.ipv4
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/sno1.ipv4" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/sno1.ipv4</a> -o /opt/dnsmasq/include.d/sno1.ipv4
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/sno2.ipv4" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/sno2.ipv4</a> -o /opt/dnsmasq/include.d/sno2.ipv4
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/infrastructure-host.ipv4" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/infrastructure-host.ipv4</a> -o /opt/dnsmasq/include.d/infrastructure-host.ipv4
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/dnsmasq-virt.service" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/dnsmasq/dnsmasq-virt.service</a> -o /etc/systemd/system/dnsmasq-virt.service
[root@hypervisor ~]# touch /opt/dnsmasq/hosts.leases
[root@hypervisor ~]# semanage fcontext -a -t dnsmasq_lease_t /opt/dnsmasq/hosts.leases
[root@hypervisor ~]# restorecon /opt/dnsmasq/hosts.leases
[root@hypervisor ~]# systemctl daemon-reload
[root@hypervisor ~]# systemctl enable --now dnsmasq-virt
[root@hypervisor ~]# systemctl mask dnsmasq</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-local-dns-as-primary-server"><a class="anchor" href="#configure-local-dns-as-primary-server"></a>Configure Local DNS as Primary Server</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# curl -L <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hypervisor/forcedns" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hypervisor/forcedns</a> -o /etc/NetworkManager/dispatcher.d/forcedns
[root@hypervisor ~]# chmod +x /etc/NetworkManager/dispatcher.d/forcedns
[root@hypervisor ~]# systemctl restart NetworkManager
[root@hypervisor ~]# /etc/NetworkManager/dispatcher.d/forcedns</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disable-firewall"><a class="anchor" href="#disable-firewall"></a>Disable Firewall</h3>
<div class="paragraph">
<p>You can also create the required rules in the firewall if you want, but for the sake of simplicity we are disabling the firewall.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# systemctl disable firewalld iptables
[root@hypervisor ~]# systemctl stop firewalld iptables
[root@hypervisor ~]# iptables -F</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-sushytools"><a class="anchor" href="#install-sushytools"></a>Install Sushy Tools</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# curl -L <a href="https://gist.githubusercontent.com/mvazquezc/0acb9e716c329abb9a184f1bcceed591/raw/4ae558082a3289d5d46be7d745bc2474e834e238/deploy-sushy-tools.sh" class="bare">https://gist.githubusercontent.com/mvazquezc/0acb9e716c329abb9a184f1bcceed591/raw/4ae558082a3289d5d46be7d745bc2474e834e238/deploy-sushy-tools.sh</a> -o /tmp/deploy-sushy-tools.sh
[root@hypervisor ~]# chmod +x /tmp/deploy-sushy-tools.sh
[root@hypervisor ~]# /tmp/deploy-sushy-tools.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-disconnected-registry"><a class="anchor" href="#configure-disconnected-registry"></a>Configure Disconnected Registry</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# dnf -y install podman httpd-tools
[root@hypervisor ~]# REGISTRY_NAME=infra.5g-deployment.lab
[root@hypervisor ~]# mkdir -p /opt/registry/{auth,certs,data,conf}
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/registry-key.pem" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/registry-key.pem</a> -o /opt/registry/certs/registry-key.pem
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/registry-cert.pem" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/registry-cert.pem</a> -o /opt/registry/certs/registry-cert.pem
[root@hypervisor ~]# htpasswd -bBc /opt/registry/auth/htpasswd admin r3dh4t1!
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/config.yml" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/config.yml</a> -o /opt/registry/conf/config.yml
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/podman-registry.service" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/registry/podman-registry.service</a> -o /etc/systemd/system/podman-registry.service
[root@hypervisor ~]# systemctl daemon-reload
[root@hypervisor ~]# systemctl enable podman-registry --now
[root@hypervisor ~]# cp /opt/registry/certs/registry-cert.pem /etc/pki/ca-trust/source/anchors/
[root@hypervisor ~]# update-ca-trust
[root@hypervisor ~]# podman login --authfile auth.json -u admin  infra.5g-deployment.lab:8443 -p r3dh4t1!</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-git-server"><a class="anchor" href="#configure-git-server"></a>Configure Git Server</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# mkdir -p /opt/gitea/
[root@hypervisor ~]# chown -R 1000:1000 /opt/gitea/
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/gitea/podman-gitea.service" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/gitea/podman-gitea.service</a> -o /etc/systemd/system/podman-gitea.service
[root@hypervisor ~]# systemctl daemon-reload
[root@hypervisor ~]# systemctl enable podman-gitea --now
[root@hypervisor ~]# podman exec --user 1000 gitea /bin/sh -c 'gitea admin user create --username student --password student --email <a href="mailto:student@5g-deployment.lab">student@5g-deployment.lab</a> --must-change-password=false --admin'
[root@hypervisor ~]# curl -u 'student:student' -H 'Content-Type: application/json' -X POST --data '{"service":"2","clone_addr":"https://github.com/RHsyseng/5g-ran-deployments-on-ocp-lab.git","uid":1,"repo_name":"5g-ran-deployments-on-ocp-lab"}' <a href="http://infra.5g-deployment.lab:3000/api/v1/repos/migrate" class="bare">http://infra.5g-deployment.lab:3000/api/v1/repos/migrate</a></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-openshift-nodes-vms"><a class="anchor" href="#create-openshift-nodes-vms"></a>Create OpenShift Nodes VMs</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# kcli create pool -p /var/lib/libvirt/images default
[root@hypervisor ~]# kcli create vm -P start=False -P uefi_legacy=true -P plan=hub -P memory=48000 -P numcpus=16 -P disks=[200,200] -P nets=['{"name": "5gdeploymentlab", "mac": "aa:aa:aa:aa:01:01"}'] -P uuid=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0101 hub-master0
[root@hypervisor ~]# kcli create vm -P start=False -P uefi_legacy=true -P plan=hub -P memory=48000 -P numcpus=16 -P disks=[200,200] -P nets=['{"name": "5gdeploymentlab", "mac": "aa:aa:aa:aa:01:02"}'] -P uuid=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0102 hub-master1
[root@hypervisor ~]# kcli create vm -P start=False -P uefi_legacy=true -P plan=hub -P memory=48000 -P numcpus=16 -P disks=[200,200] -P nets=['{"name": "5gdeploymentlab", "mac": "aa:aa:aa:aa:01:03"}'] -P uuid=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0103 hub-master2
[root@hypervisor ~]# kcli create vm -P start=False -P uefi_legacy=true -P plan=hub -P memory=24000 -P numcpus=12 -P disks=[200,200] -P nets=['{"name": "5gdeploymentlab", "mac": "aa:aa:aa:aa:02:01"}'] -P uuid=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0201 sno1
[root@hypervisor ~]# kcli create vm -P start=False -P uefi_legacy=true -P plan=hub -P memory=24000 -P numcpus=12 -P disks=[200,200] -P nets=['{"name": "5gdeploymentlab", "mac": "aa:aa:aa:aa:03:01"}'] -P uuid=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0301 sno2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-openshift-hub-cluster"><a class="anchor" href="#deploy-openshift-hub-cluster"></a>Deploy OpenShift Hub Cluster</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This step requires a valid OpenShift Pull Secret placed in /root/openshift_pull.json
</td>
</tr>
</table>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# git clone <a href="https://github.com/karmab/kcli-openshift4-baremetal.git" class="bare">https://github.com/karmab/kcli-openshift4-baremetal.git</a>
[root@hypervisor ~]# curl -sL <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/hub.yml" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/hub.yml</a> -o /root/kcli-openshift4-baremetal/hub.yml
[root@hypervisor ~]# cp /root/openshift_pull.json /root/kcli-openshift4-baremetal/openshift_pull.json
[root@hypervisor ~]# cd /root/kcli-openshift4-baremetal/
[root@hypervisor kcli-openshift4-baremetal]# kcli create plan --pf hub.yml --force</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will take around 1 hour to complete, you can follow progress by running <code>kcli console -s</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-openshift-hub-cluster"><a class="anchor" href="#configure-openshift-hub-cluster"></a>Configure OpenShift Hub Cluster</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor kcli-openshift4-baremetal]# cd ~
[root@hypervisor ~]# kcli ssh hub-installer -- "sudo cp /root/ocp/auth/kubeconfig /tmp/kubeconfig &amp;&amp; sudo chmod 644 /tmp/kubeconfig"
[root@hypervisor ~]# kcli scp hub-installer:/tmp/kubeconfig ~/hub-kubeconfig
[root@hypervisor ~]# export KUBECONFIG=~/hub-kubeconfig
[root@hypervisor ~]# oc apply -f <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/lvmcluster.yaml" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/lvmcluster.yaml</a>
[root@hypervisor ~]# oc -n openshift-storage wait lvmcluster odf-lvmcluster --for=jsonpath='{.status.ready}'=true --timeout=900s
[root@hypervisor ~]# oc patch storageclass odf-lvm-vg1 -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
[root@hypervisor ~]# curl <a href="https://raw.githubusercontent.com/openshift-kni/cnf-features-deploy/master/ztp/gitops-subscriptions/argocd/deployment/argocd-openshift-gitops-patch.json" class="bare">https://raw.githubusercontent.com/openshift-kni/cnf-features-deploy/master/ztp/gitops-subscriptions/argocd/deployment/argocd-openshift-gitops-patch.json</a> -o /tmp/argopatch.json
[root@hypervisor ~]# oc patch argocd openshift-gitops -n openshift-gitops --type=merge --patch-file /tmp/argopatch.json
[root@hypervisor ~]# oc wait --for=condition=Ready pod -lapp.kubernetes.io/name=openshift-gitops-repo-server -n openshift-gitops
[root@hypervisor ~]# oc -n openshift-gitops adm policy add-cluster-role-to-user cluster-admin -z openshift-gitops-argocd-application-controller</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-openshift-hub-cluster-operators"><a class="anchor" href="#deploy-openshift-hub-cluster-operators"></a>Deploy OpenShift HUB Cluster Operators</h3>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# oc apply -f <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/hub-operators-argoapps.yaml" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/hub-operators-argoapps.yaml</a></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-sno1-cluster-without-ztp"><a class="anchor" href="#deploy-sno1-cluster-without-ztp"></a>Deploy SNO1 Cluster (without ZTP)</h3>
<div class="paragraph">
<p>A SNO is deployed outside the ZTP workflow so students can import it and see how that workflow works.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# curl -L <a href="http://infra.5g-deployment.lab:3000/student/5g-ran-deployments-on-ocp-lab/raw/branch/main/lab-materials/lab-env-data/hypervisor/ssh-key" class="bare">http://infra.5g-deployment.lab:3000/student/5g-ran-deployments-on-ocp-lab/raw/branch/main/lab-materials/lab-env-data/hypervisor/ssh-key</a> -o /root/.ssh/snokey
[root@hypervisor ~]# chmod 400 /root/.ssh/snokey
[root@hypervisor ~]# oc apply -f <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/sno1-argoapp.yaml" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/hub-cluster/sno1-argoapp.yaml</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the cluster is deployed, the kubeconfig can be gathered as follows:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# oc -n sno1 get agentclusterinstall,agent
NAME                                                    CLUSTER   STATE
agentclusterinstall.extensions.hive.openshift.io/sno1   sno1      adding-hosts

NAME                                                                    CLUSTER   APPROVED   ROLE     STAGE
agent.agent-install.openshift.io/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaa0201   sno1      true       master   Done

[root@hypervisor ~]# oc extract secret/sno1-admin-kubeconfig --to=- -n sno1 &gt; /root/sno1kubeconfig
[root@hypervisor ~]# oc --kubeconfig /root/sno1kubeconfig get nodes,clusterversion

NAME                      STATUS   ROLES           AGE   VERSION
node/openshift-master-0   Ready    master,worker   46m   v1.24.6+5157800

NAME                                         VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS
clusterversion.config.openshift.io/version   4.11.13   True        False         22m     Cluster version is 4.11.13</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-access-to-cluster-apps"><a class="anchor" href="#configure-access-to-cluster-apps"></a>Configure Access to Cluster Apps</h3>
<div class="paragraph">
<p>In order to access the hub cluster we will deploy an HAProxy that will be listeting on the public interface of the Hypervisor host.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@hypervisor ~]# dnf install haproxy -y
[root@hypervisor ~]# semanage port -a -t http_port_t -p tcp 6443
[root@hypervisor ~]# curl -L <a href="https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/haproxy/haproxy.cfg" class="bare">https://raw.githubusercontent.com/RHsyseng/5g-ran-deployments-on-ocp-lab/main/lab-materials/lab-env-data/haproxy/haproxy.cfg</a> -o /etc/haproxy/haproxy.cfg
[root@hypervisor ~]# systemctl enable haproxy --now</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you need to add the following entries to your /etc/hosts file:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&lt;HYPERVISOR_REACHABLE_IP&gt; infra.5g-deployment.lab api.hub.5g-deployment.lab console-openshift-console.apps.hub.5g-deployment.lab oauth-openshift.apps.hub.5g-deployment.lab openshift-gitops-server-openshift-gitops.apps.hub.5g-deployment.lab</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="11-deployment-considerations.html">Deployment Considerations</a></span>
  <span class="next"><a href="23-lab-environment-introduction.html">Introduction to the Lab Environment</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
